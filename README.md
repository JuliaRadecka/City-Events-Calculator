# City Events Calculator (Excel‑backed)

Минимальный репозиторий: **1 исходник Excel (.xlsm) + 1 файл приложения (app.py)**.

Цель текущей версии: 
- Отрисовать рабочую область городского шаблона **C20:O146** (Шаг A).
- Дать ввод в **серые ячейки** (editable) и сохранить изменения обратно в новый `.xlsm`.
- Показать **значения** (а не формулы) там, где в файле сохранены вычисленные результаты.

> Важно: Python не пересчитывает Excel‑формулы автоматически. Streamlit показывает **кэшированные значения**, которые были сохранены в файле Excel. Если в ячейках видны пустые значения, откройте файл в Excel, дождитесь пересчёта и сохраните файл — после этого значения появятся в приложении.

## Файлы
- `Calculator.xlsm` — исходник калькулятора (лежит рядом с кодом).
- `app.py` — Streamlit‑приложение.
- `requirements.txt` — зависимости.

## Запуск (Windows)
```powershell
cd "C:\path\to\calculator_repo"
py -m pip install --upgrade pip
py -m pip install -r requirements.txt
py -m streamlit run app.py
```

## Как это соотносится со Шагами A/B
- **Шаг A**: UI показывает диапазон C20:O146 и разрешает редактировать только серые ячейки.
- **Шаг B**: пока используем `.xlsm` как единый источник данных (без разрезания на CSV). Нормализация строковых ключей и перенос формул в код — следующий этап.

## Ограничения текущей версии
- **Merged cells** (объединённые ячейки) визуально не воспроизводятся 1‑в‑1 в табличном виджете Streamlit. Для этого нужен отдельный UI‑рендеринг сетки.
- Выпадающие списки/валидаторы из Excel пока не подхватываются автоматически в таблице (частично реализовано только для верхнего блока).
- Пересчёт формул и замена `#REF!` на динамическую логику — будет реализовано в engine на шаге C.
